<html>
  <head>
  </head>
  <body>
    <div>
      <input type="text"id='email' placeholder="Email">
    </div>

    <div>
      <input type="text" id='card_holder' placeholder='Card Holder'>
    </div>

    <div id="success"></div>

    <div id="inline-widget"></div>
    <script src="https://test.tap2pay.me/inline_widget/v1.js">

    </script>

    <script>
      var t2pInlineWidget = new T2P.InlineWidget("#inline-widget", {id: "oCwxeJ2r"});
    </script>

    <button id="pay">Pay</button>

    <script>
      let iframeName
      let email
      let cardHolder
      let frame
      let data
      let success
      let iframe2 = document.getElementsByName("t2p_inline_widget")[0]
      iframe2.onload = function() {
        data = {
          type: 'styles',
          params: `
            body {
              background-color: blue;
              font-size: 15px;
            }
            .inline_gateway {
              border: 4px solid red;
              border-radius: 10px;
              background-color: pink;
            }
          `
        }
        frame = window.frames.t2p_inline_widget
        frame.postMessage(JSON.stringify(data), '*')
      }

      let button = document.getElementById('pay')
      button.addEventListener('click', (e) => {
        email = document.getElementById('email')
        cardHolder = document.getElementById('card_holder')
        data = {
          type: 'card_fields',
          params: {
            email: email.value,
            card_holder: cardHolder.value
          }
        }
        frame = window.frames.t2p_inline_widget
        frame.postMessage(JSON.stringify(data), '*')
      })

      messageHandler = function(event) {
        let data = event.data
        if(data.action == 'resizeIframe') {
          iframeName = document.getElementsByName('t2p_inline_widget')[0]
          iframeName.setAttribute('height', data.data.height)
        } else if(data.action == 'complete') {
          console.log('Success')
          success = document.getElementById('success')
          success.innerText = 'Success!!'
        }
      }

      window.addEventListener("message", messageHandler)
    </script>
  </body>
</html>
